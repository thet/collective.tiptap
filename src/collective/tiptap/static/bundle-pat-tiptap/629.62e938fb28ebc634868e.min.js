"use strict";(self.webpackChunk_patternslib_pat_tiptap=self.webpackChunk_patternslib_pat_tiptap||[]).push([[629],{6893:function(e,t,n){n.d(t,{pf:function(){return d}});var r=n(6798),o=n(6922),i=n(8780);const a=new o.H$("suggestion");function s({pluginKey:e=a,editor:t,char:n="@",allowSpaces:r=!1,prefixSpace:s=!0,startOfLine:l=!1,decorationTag:d="span",decorationClass:c="suggestion",command:u=(()=>null),items:p=(()=>[]),render:g=(()=>({})),allow:f=(()=>!0)}){const m=null==g?void 0:g();return new o.Sy({key:e,view(){return{update:async(e,n)=>{var r,o,i,a,s;const l=null===(r=this.key)||void 0===r?void 0:r.getState(n),d=null===(o=this.key)||void 0===o?void 0:o.getState(e.state),c=l.active&&d.active&&l.range.from!==d.range.from,g=!l.active&&d.active,f=l.active&&!d.active,v=g||c,h=!g&&!f&&l.query!==d.query&&!c,b=f||c;if(!v&&!h&&!b)return;const y=b&&!v?l:d,w=document.querySelector(`[data-decoration-id="${y.decorationId}"]`),x={editor:t,range:y.range,query:y.query,text:y.text,items:h||v?await p(y.query):[],command:e=>{u({editor:t,range:y.range,props:e})},decorationNode:w,clientRect:w?()=>{var e;const{decorationId:n}=null===(e=this.key)||void 0===e?void 0:e.getState(t.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null};b&&(null===(i=null==m?void 0:m.onExit)||void 0===i||i.call(m,x)),h&&(null===(a=null==m?void 0:m.onUpdate)||void 0===a||a.call(m,x)),v&&(null===(s=null==m?void 0:m.onStart)||void 0===s||s.call(m,x))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(e,o){const{composing:i}=t.view,{selection:a}=e,{empty:d,from:c}=a,u={...o};if(u.composing=i,d||t.view.composing){!(c<o.range.from||c>o.range.to)||i||o.composing||(u.active=!1);const e=function(e){const{char:t,allowSpaces:n,prefixSpace:r,startOfLine:o,$position:i}=e,a=t.split("").map((e=>`\\${e}`)).join(""),s=new RegExp(`\\s${a}$`),l=o?"^":"",d=n?new RegExp(`${l}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${l}(?:^)?${a}[^\\s${a}]*`,"gm"),c=i.depth<=0?0:i.before(),u=i.pos,p=i.doc.textBetween(c,u,"\0","\0"),g=Array.from(p.matchAll(d)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const f=g.input.slice(Math.max(0,g.index-1),g.index),m=/^[\s\0]?$/.test(f);if(r&&!m)return null;const v=g.index+i.start();let h=v+g[0].length;return n&&s.test(p.slice(h-1,h+1))&&(g[0]+=" ",h+=1),v<i.pos&&h>=i.pos?{range:{from:v,to:h},query:g[0].slice(t.length),text:g[0]}:null}({char:n,allowSpaces:r,prefixSpace:s,startOfLine:l,$position:a.$from}),d=`id_${Math.floor(4294967295*Math.random())}`;e&&f({editor:t,range:e.range})?(u.active=!0,u.decorationId=o.decorationId?o.decorationId:d,u.range=e.range,u.query=e.query,u.text=e.text):u.active=!1}else u.active=!1;return u.active||(u.decorationId=null,u.range={},u.query=null,u.text=null),u}},props:{handleKeyDown(e,t){var n;const{active:r,range:o}=this.getState(e.state);return r&&(null===(n=null==m?void 0:m.onKeyDown)||void 0===n?void 0:n.call(m,{view:e,event:t,range:o}))||!1},decorations(e){const{active:t,range:n,decorationId:r}=this.getState(e);return t?i.EH.create(e.doc,[i.p.inline(n.from,n.to,{nodeName:d,class:c,"data-decoration-id":r})]):null}}})}const l=new o.H$("mention"),d=r.Node.create({name:"mention",defaultOptions:{HTMLAttributes:{},renderLabel({options:e,node:t}){var n;return`${e.suggestion.char}${null!==(n=t.attrs.label)&&void 0!==n?n:t.attrs.id}`},suggestion:{char:"@",pluginKey:l,command:({editor:e,range:t,props:n})=>{var r;const o=e.view.state.selection.$to.nodeAfter;(null===(r=null==o?void 0:o.text)||void 0===r?void 0:r.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:"mention",attrs:n},{type:"text",text:" "}]).run()},allow:({editor:e,range:t})=>{const n=e.state.doc.resolve(t.from),r=e.schema.nodes.mention;return!!n.parent.type.contentMatch.matchType(r)}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML:()=>[{tag:"span[data-mention]"}],renderHTML({node:e,HTMLAttributes:t}){return["span",(0,r.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:e,state:t})=>{let n=!1;const{selection:r}=t,{empty:o,anchor:i}=r;return!!o&&(t.doc.nodesBetween(i-1,i,((t,r)=>{if(t.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",r,r+t.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})},9629:function(e,t,n){n.r(t),n.d(t,{Mention:function(){return l}});var r=n(6798),o=n(6893);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=o.pf.extend({defaultOptions:a(a({},o.pf.options),{},{url_scheme:null}),addAttributes:function(){var e=this;return{id:{default:null,parseHTML:function(e){return e.getAttribute("data-id")},renderHTML:function(e){return e.id?{"data-id":e.id}:{}}},href:{default:null,parseHTML:function(e){return e.getAttribute("href")},renderHTML:function(t){return t.id?{href:e.options.url_scheme.replace("{USER}",t.id)}:{}}}}},parseHTML:function(){return[{tag:"a[data-mention]"}]},renderHTML:function(e){var t=e.node,n=e.HTMLAttributes;return["a",(0,r.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:t})]}})}}]);