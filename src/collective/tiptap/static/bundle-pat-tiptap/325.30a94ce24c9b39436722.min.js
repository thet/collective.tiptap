"use strict";(self.webpackChunk_patternslib_pat_tiptap=self.webpackChunk_patternslib_pat_tiptap||[]).push([[325],{6893:function(t,e,n){n.d(e,{pf:function(){return c}});var r=n(6798),o=n(6922),i=n(8780);const a=new o.H$("suggestion");function s({pluginKey:t=a,editor:e,char:n="@",allowSpaces:r=!1,prefixSpace:s=!0,startOfLine:l=!1,decorationTag:c="span",decorationClass:d="suggestion",command:u=(()=>null),items:p=(()=>[]),render:g=(()=>({})),allow:f=(()=>!0)}){const v=null==g?void 0:g();return new o.Sy({key:t,view(){return{update:async(t,n)=>{var r,o,i,a,s;const l=null===(r=this.key)||void 0===r?void 0:r.getState(n),c=null===(o=this.key)||void 0===o?void 0:o.getState(t.state),d=l.active&&c.active&&l.range.from!==c.range.from,g=!l.active&&c.active,f=l.active&&!c.active,m=g||d,h=!g&&!f&&l.query!==c.query&&!d,y=f||d;if(!m&&!h&&!y)return;const b=y&&!m?l:c,w=document.querySelector(`[data-decoration-id="${b.decorationId}"]`),x={editor:e,range:b.range,query:b.query,text:b.text,items:h||m?await p(b.query):[],command:t=>{u({editor:e,range:b.range,props:t})},decorationNode:w,clientRect:w?()=>{var t;const{decorationId:n}=null===(t=this.key)||void 0===t?void 0:t.getState(e.state);return document.querySelector(`[data-decoration-id="${n}"]`).getBoundingClientRect()}:null};y&&(null===(i=null==v?void 0:v.onExit)||void 0===i||i.call(v,x)),h&&(null===(a=null==v?void 0:v.onUpdate)||void 0===a||a.call(v,x)),m&&(null===(s=null==v?void 0:v.onStart)||void 0===s||s.call(v,x))}}},state:{init:()=>({active:!1,range:{},query:null,text:null,composing:!1}),apply(t,o){const{composing:i}=e.view,{selection:a}=t,{empty:c,from:d}=a,u={...o};if(u.composing=i,c||e.view.composing){!(d<o.range.from||d>o.range.to)||i||o.composing||(u.active=!1);const t=function(t){const{char:e,allowSpaces:n,prefixSpace:r,startOfLine:o,$position:i}=t,a=e.split("").map((t=>`\\${t}`)).join(""),s=new RegExp(`\\s${a}$`),l=o?"^":"",c=n?new RegExp(`${l}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${l}(?:^)?${a}[^\\s${a}]*`,"gm"),d=i.depth<=0?0:i.before(),u=i.pos,p=i.doc.textBetween(d,u,"\0","\0"),g=Array.from(p.matchAll(c)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const f=g.input.slice(Math.max(0,g.index-1),g.index),v=/^[\s\0]?$/.test(f);if(r&&!v)return null;const m=g.index+i.start();let h=m+g[0].length;return n&&s.test(p.slice(h-1,h+1))&&(g[0]+=" ",h+=1),m<i.pos&&h>=i.pos?{range:{from:m,to:h},query:g[0].slice(e.length),text:g[0]}:null}({char:n,allowSpaces:r,prefixSpace:s,startOfLine:l,$position:a.$from}),c=`id_${Math.floor(4294967295*Math.random())}`;t&&f({editor:e,range:t.range})?(u.active=!0,u.decorationId=o.decorationId?o.decorationId:c,u.range=t.range,u.query=t.query,u.text=t.text):u.active=!1}else u.active=!1;return u.active||(u.decorationId=null,u.range={},u.query=null,u.text=null),u}},props:{handleKeyDown(t,e){var n;const{active:r,range:o}=this.getState(t.state);return r&&(null===(n=null==v?void 0:v.onKeyDown)||void 0===n?void 0:n.call(v,{view:t,event:e,range:o}))||!1},decorations(t){const{active:e,range:n,decorationId:r}=this.getState(t);return e?i.EH.create(t.doc,[i.p.inline(n.from,n.to,{nodeName:c,class:d,"data-decoration-id":r})]):null}}})}const l=new o.H$("mention"),c=r.Node.create({name:"mention",defaultOptions:{HTMLAttributes:{},renderLabel({options:t,node:e}){var n;return`${t.suggestion.char}${null!==(n=e.attrs.label)&&void 0!==n?n:e.attrs.id}`},suggestion:{char:"@",pluginKey:l,command:({editor:t,range:e,props:n})=>{var r;const o=t.view.state.selection.$to.nodeAfter;(null===(r=null==o?void 0:o.text)||void 0===r?void 0:r.startsWith(" "))&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:"mention",attrs:n},{type:"text",text:" "}]).run()},allow:({editor:t,range:e})=>{const n=t.state.doc.resolve(e.from),r=t.schema.nodes.mention;return!!n.parent.type.contentMatch.matchType(r)}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}),parseHTML:()=>[{tag:"span[data-mention]"}],renderHTML({node:t,HTMLAttributes:e}){return["span",(0,r.mergeAttributes)({"data-mention":""},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t})]},renderText({node:t}){return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:o,anchor:i}=r;return!!o&&(e.doc.nodesBetween(i-1,i,((e,r)=>{if(e.type.name===this.name)return n=!0,t.insertText(this.options.suggestion.char||"",r,r+e.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[s({editor:this.editor,...this.options.suggestion})]}})},325:function(t,e,n){n.r(e),n.d(e,{TagPluginKey:function(){return l},Tag:function(){return c}});var r=n(6798),o=n(6893);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=new(n(6922).H$)("tag"),c=o.pf.extend({name:"tag",defaultOptions:a(a({},o.pf.options),{},{suggestion:a(a({},o.pf.options.suggestion),{},{pluginKey:l,char:"#",command:function(t){var e,n=t.editor,r=t.range,o=t.props,i=n.view.state.selection.$to.nodeAfter;(null==i||null===(e=i.text)||void 0===e?void 0:e.startsWith(" "))&&(r.to+=1),n.chain().focus().insertContentAt(r,[{type:"tag",attrs:o},{type:"text",text:" "}]).run()},allow:function(t){var e=t.editor,n=t.range;return e.can().insertContentAt(n,{type:"tag"})}}),url_scheme:null}),addAttributes:function(){var t=this;return{id:{default:null,parseHTML:function(t){return t.getAttribute("data-id")},renderHTML:function(t){return t.id?{"data-id":t.id}:{}}},href:{default:null,parseHTML:function(t){return t.getAttribute("href")},renderHTML:function(e){return e.id?{href:t.options.url_scheme.replace("{TAG}",e.id)}:{}}}}},parseHTML:function(){return[{tag:"a[data-tag]"}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes;return["a",(0,r.mergeAttributes)({"data-tag":""},this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:e})]}})}}]);